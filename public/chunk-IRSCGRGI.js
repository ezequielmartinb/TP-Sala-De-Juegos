import{a as P,b as I,c as V,d as F}from"./chunk-ILSLAPDQ.js";import{a as E}from"./chunk-VQ3PVDQZ.js";import{k as O,m as k}from"./chunk-7LMTQFKZ.js";import{Ca as h,Ga as f,Na as C,Pa as r,Qa as s,Sa as x,Ta as g,W as m,Wa as j,X as c,Xa as M,Ya as _,_a as l,ab as v,bb as b,cb as w,db as y,eb as S,sa as a,xa as u}from"./chunk-3UVLN3EJ.js";import"./chunk-FK42CRUA.js";var D=["messagesContainer"];function T(o,e){if(o&1&&(r(0,"div",7)(1,"strong"),l(2),s(),l(3),s()),o&2){let t=e.$implicit;a(2),b("",t.time," ",t.user,":"),a(),v(" ",t.text," ")}}var N=class o{constructor(e){this.authService=e;this.username=this.authService.getUsuario()}messagesContainer;mensajes=[];mensaje="";username;ngOnInit(){let e=localStorage.getItem("chatMensajes");e&&(this.mensajes=JSON.parse(e)),setInterval(()=>this.limpiarMensajes(),60*1e3)}enviarMensaje(){if(this.mensaje.trim()){let t=new Date().toLocaleTimeString();this.mensajes.push({user:this.username,text:this.mensaje,time:t,timestamp:Date.now()}),localStorage.setItem("chatMensajes",JSON.stringify(this.mensajes)),this.mensaje="",this.mensajes.length>4&&this.mensajes.shift(),requestAnimationFrame(()=>this.bloquearScrollBar())}}bloquearScrollBar(){if(this.messagesContainer){let e=this.messagesContainer.nativeElement;e.scrollHeight>e.clientHeight&&(e.scrollTop=e.scrollHeight)}}limpiarMensajes(){let t=Date.now();this.mensajes=this.mensajes.filter(n=>t-n.timestamp<6e4),localStorage.setItem("chatMensajes",JSON.stringify(this.mensajes))}obtenerMensajesOrdenados(){return this.mensajes.slice().sort((e,t)=>t.timestamp-e.timestamp)}static \u0275fac=function(t){return new(t||o)(u(E))};static \u0275cmp=h({type:o,selectors:[["app-chat"]],viewQuery:function(t,n){if(t&1&&j(D,5),t&2){let i;M(i=_())&&(n.messagesContainer=i.first)}},decls:8,vars:2,consts:[["messagesContainer",""],[1,"chat-container"],[1,"messages"],["class","message",4,"ngFor","ngForOf"],[1,"input-container"],["placeholder","Escribe tu mensaje...",3,"ngModelChange","keyup.enter","ngModel"],[3,"click"],[1,"message"]],template:function(t,n){if(t&1){let i=x();r(0,"div",1)(1,"div",2,0),f(3,T,4,3,"div",3),s(),r(4,"div",4)(5,"input",5),S("ngModelChange",function(p){return m(i),y(n.mensaje,p)||(n.mensaje=p),c(p)}),g("keyup.enter",function(){return m(i),c(n.enviarMensaje())}),s(),r(6,"button",6),g("click",function(){return m(i),c(n.enviarMensaje())}),l(7,"Enviar"),s()()()}t&2&&(a(3),C("ngForOf",n.obtenerMensajesOrdenados()),a(2),w("ngModel",n.mensaje))},dependencies:[F,P,I,V,k,O],styles:[".chat-container[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;width:600px;background-color:#fff;border:1px solid #ccc;padding:10px;box-shadow:2px 2px 10px #0003;max-height:300px;overflow-y:auto}.messages[_ngcontent-%COMP%]{max-height:300px;overflow:hidden;display:flex;flex-direction:column-reverse}.message[_ngcontent-%COMP%]{color:#000;margin-bottom:5px;background:#e0e0e0;border-radius:4px;display:flex;align-items:center;white-space:nowrap;padding:2px 5px;font-size:14px}.timestamp[_ngcontent-%COMP%]{font-size:.8em;color:gray}.input-container[_ngcontent-%COMP%]{display:flex;gap:5px;margin-top:10px;align-items:center}input[_ngcontent-%COMP%]{flex:1;padding:6px;font-size:14px}button[_ngcontent-%COMP%]{padding:6px 12px;cursor:pointer;background-color:#007bff;color:#fff;border:none;border-radius:4px;font-weight:700}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})};export{N as ChatComponent};
