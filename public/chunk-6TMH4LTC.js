import{a as F,b as A,c as L,d as U,e as z,f as H,g as W,h as G}from"./chunk-4X2JWVYH.js";import{a as B,b as v}from"./chunk-H25SF227.js";import{j as P,k,l as V,m as D,n as R}from"./chunk-3O2RVLND.js";import{Ca as y,Ha as C,Oa as m,Qa as o,Ra as r,Sa as M,Ta as _,W as d,Wa as f,X as p,Xa as c,bb as l,cb as w,db as x,eb as I,fb as S,gb as T,kb as E,lb as O,pb as N,qa as j,sa as s,xa as u}from"./chunk-ZFR65RDR.js";import{h}from"./chunk-FK42CRUA.js";function X(n,t){if(n&1){let e=_();o(0,"div",2),f("click",function(){d(e);let i=c();return i.mostrarChat=!0,p(i.scrollToTheLastElementByClassName())}),M(1,"img",3),r()}if(n&2){let e=c();s(),m("src",e.iconoChat,j)}}function q(n,t){if(n&1&&(o(0,"p",14)(1,"small",15),l(2),E(3,"date"),r(),o(4,"strong"),l(5),r(),o(6,"small"),l(7),r()()),n&2){let e=t.$implicit,a=c(2);m("ngClass",a.username==e.emisor?"enviado":"recibido"),s(2),x("",O(3,4,e.fecha,"dd/MM/yyyy HH:mm")," "),s(3),x("",e.emisor,": "),s(2),w(e.texto)}}function J(n,t){if(n&1){let e=_();o(0,"div",4)(1,"div",5),l(2," CHAT "),o(3,"div",6),f("click",function(){d(e);let i=c();return p(i.mostrarChat=!1)}),l(4,"X"),r()(),o(5,"div",7)(6,"div",8),C(7,q,8,7,"p",9),r()(),o(8,"form",10),f("ngSubmit",function(){d(e);let i=c();return p(i.enviarMensaje())}),o(9,"input",11),T("ngModelChange",function(i){d(e);let b=c();return S(b.nuevoMensaje,i)||(b.nuevoMensaje=i),p(i)}),r(),o(10,"div",12)(11,"span",13)(12,"button"),l(13,"Enviar"),r()()()()()}if(n&2){let e=c();s(7),m("ngForOf",e.mensajes),s(2),I("ngModel",e.nuevoMensaje)}}var g=B(v.apiUrl,v.publicAnonKey),K=class n{constructor(t,e){this.authService=t;this.cdRef=e;this.username=this.authService.getUsuario(),this.obtenerIconos()}nuevoMensaje="";username;mensajes=[];mostrarChat=!1;iconoChat="";ngOnInit(){this.obtenerMensajes(),g.channel("mensajes").on("postgres_changes",{event:"INSERT",schema:"public",table:"mensajes"},t=>{this.mensajes.push(t.new),this.cdRef.detectChanges(),this.scrollToTheLastElementByClassName()}).subscribe()}enviarMensaje(){return h(this,null,function*(){if(this.nuevoMensaje.trim()==="")return;let t={emisor:this.username,texto:this.nuevoMensaje,fecha:new Date},{error:e}=yield g.from("mensajes").insert([t]);if(e){console.error("Error al guardar el mensaje:",e);return}this.mensajes.push(t),this.nuevoMensaje="",setTimeout(()=>this.scrollToTheLastElementByClassName(),30)})}obtenerMensajes(){return h(this,null,function*(){let{data:t,error:e}=yield g.from("mensajes").select("*").order("fecha",{ascending:!0});if(e){console.error("Error al obtener mensajes:",e);return}this.mensajes=t||[],this.cdRef.detectChanges()})}scrollToTheLastElementByClassName(){setTimeout(()=>{let t=document.getElementById("mensajes");t&&(t.scrollTop=t.scrollHeight)},100)}obtenerIconos(){return h(this,null,function*(){let{data:t}=yield g.storage.from("images").getPublicUrl("chat.ico");this.iconoChat=t.publicUrl,this.cdRef.detectChanges()})}static \u0275fac=function(e){return new(e||n)(u(G),u(N))};static \u0275cmp=y({type:n,selectors:[["app-chat"]],decls:2,vars:2,consts:[["class","chatIconContainer",3,"click",4,"ngIf"],["class","card text-center contenedor-chat",4,"ngIf"],[1,"chatIconContainer",3,"click"],["alt","chat Icon",1,"chatIcon",3,"src"],[1,"card","text-center","contenedor-chat"],[1,"card-header"],[1,"closeIcon",3,"click"],[1,"card-body"],["id","mensajes",1,"contenedor-mensajes","h-100"],["class","msj p-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card-footer","text-muted","input-group",3,"ngSubmit"],["type","text","placeholder","Escriba un mensaje...",1,"form-control",3,"ngModelChange","ngModel"],[1,"input-group-append"],["id","basic-addon2",1,"input-group-text"],[1,"msj","p-2",3,"ngClass"],[1,"mensaje-fecha"]],template:function(e,a){e&1&&C(0,X,2,1,"div",0)(1,J,14,2,"div",1),e&2&&(m("ngIf",!a.mostrarChat),s(),m("ngIf",a.mostrarChat))},dependencies:[W,H,F,A,L,z,U,R,P,k,V,D],styles:[".contenedor-chat[_ngcontent-%COMP%]{width:300px;height:450px;right:.5rem;bottom:.5rem;position:fixed}.card-header[_ngcontent-%COMP%]{background-color:#6666f3;color:#fff;font-weight:700}.card-body[_ngcontent-%COMP%]{padding:.5rem;background-color:#fff}.enviado[_ngcontent-%COMP%]{display:block;float:right;background-color:teal;color:#fff;min-width:50.01%;border-radius:10px;text-align:left}.recibido[_ngcontent-%COMP%]{display:block;float:left;background-color:gray;color:#fff;min-width:50.01%;border-radius:10px;text-align:left}.contenedor-mensajes[_ngcontent-%COMP%]{max-height:300px;overflow:scroll;overflow-y:auto;padding:.3rem;font-size:14px}.contenedor-mensajes[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.chatIconContainer[_ngcontent-%COMP%]{right:.5rem;bottom:.5rem;position:fixed;display:flex;justify-content:center;align-items:center;width:60px;height:60px;cursor:pointer;background-color:#a7a7a7;border-radius:100%;box-shadow:0 0 10px 2px #474747}.chatIcon[_ngcontent-%COMP%]{width:40px;height:40px}.closeIcon[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:0rem;cursor:pointer}.text-muted[_ngcontent-%COMP%]{font-size:12px;color:#fff}.mensaje-fecha[_ngcontent-%COMP%]{color:#00f;font-size:12px;font-style:italic}"]})};export{K as a};
