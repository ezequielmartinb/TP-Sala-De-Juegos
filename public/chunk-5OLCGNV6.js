import{a as G}from"./chunk-UDGL2PKL.js";import{a as B,c as F,d as L,f as U,h as z,i as H,p as W}from"./chunk-EC2R4OUN.js";import{j as N,k as P,l as V,m as D,n as R}from"./chunk-3UXFVKZA.js";import{a as v}from"./chunk-RYNEBBE2.js";import{Ca as j,Ha as C,Oa as m,Qa as o,Ra as a,Sa as M,Ta as _,W as d,Wa as u,X as p,Xa as c,bb as l,cb as w,db as x,eb as S,fb as I,gb as O,kb as T,lb as E,pb as k,qa as y,sa as s,wb as A,xa as g}from"./chunk-LTGA3DLZ.js";import{h as f}from"./chunk-FK42CRUA.js";function X(n,t){if(n&1){let e=_();o(0,"div",2),u("click",function(){d(e);let i=c();return i.mostrarChat=!0,p(i.scrollToTheLastElementByClassName())}),M(1,"img",3),a()}if(n&2){let e=c();s(),m("src",e.iconoChat,y)}}function Z(n,t){if(n&1&&(o(0,"p",14)(1,"small",15),l(2),T(3,"date"),a(),o(4,"strong"),l(5),a(),o(6,"small"),l(7),a()()),n&2){let e=t.$implicit,r=c(2);m("ngClass",r.username==e.emisor?"enviado":"recibido"),s(2),x("",E(3,4,e.fecha,"dd/MM/yyyy HH:mm")," "),s(3),x("",e.emisor,": "),s(2),w(e.texto)}}function q(n,t){if(n&1){let e=_();o(0,"div",4)(1,"div",5),l(2," CHAT "),o(3,"div",6),u("click",function(){d(e);let i=c();return p(i.mostrarChat=!1)}),l(4,"X"),a()(),o(5,"div",7)(6,"div",8),C(7,Z,8,7,"p",9),a()(),o(8,"form",10),u("ngSubmit",function(){d(e);let i=c();return p(i.enviarMensaje())}),o(9,"input",11),O("ngModelChange",function(i){d(e);let b=c();return I(b.nuevoMensaje,i)||(b.nuevoMensaje=i),p(i)}),a(),o(10,"div",12)(11,"span",13)(12,"button"),l(13,"Enviar"),a()()()()()}if(n&2){let e=c();s(7),m("ngForOf",e.mensajes),s(2),S("ngModel",e.nuevoMensaje)}}var h=A(v.apiUrl,v.publicAnonKey),K=class n{constructor(t,e){this.authService=t;this.cdRef=e;this.username=this.authService.getUsuario(),this.obtenerIconos()}nuevoMensaje="";username;mensajes=[];mostrarChat=!1;iconoChat="";mensajesSubscription;ngOnInit(){this.obtenerMensajes(),this.mensajesSubscription=h.channel("mensajes").on("postgres_changes",{event:"INSERT",schema:"public",table:"mensajes"},t=>{this.mensajes.push(t.new),this.cdRef.detectChanges(),this.cdRef.markForCheck(),this.scrollToTheLastElementByClassName()}).subscribe()}ngOnDestroy(){this.mensajesSubscription&&h.removeChannel(this.mensajesSubscription)}enviarMensaje(){return f(this,null,function*(){if(this.nuevoMensaje.trim()==="")return;let t={emisor:this.username,texto:this.nuevoMensaje,fecha:new Date().toLocaleString("en-US",{timeZone:"America/Argentina/Buenos_Aires"})},{error:e}=yield h.from("mensajes").insert([t]);if(e){console.error("Error al guardar el mensaje:",e);return}this.nuevoMensaje="",setTimeout(()=>this.scrollToTheLastElementByClassName(),30)})}obtenerMensajes(){return f(this,null,function*(){let{data:t,error:e}=yield h.from("mensajes").select("*").order("fecha",{ascending:!0});if(e){console.error("Error al obtener mensajes:",e);return}this.mensajes=t||[],this.cdRef.detectChanges()})}scrollToTheLastElementByClassName(){setTimeout(()=>{let t=document.getElementById("mensajes");t&&(t.scrollTop=t.scrollHeight)},100)}obtenerIconos(){return f(this,null,function*(){let{data:t}=yield h.storage.from("images").getPublicUrl("chat.ico");this.iconoChat=t.publicUrl,this.cdRef.detectChanges()})}static \u0275fac=function(e){return new(e||n)(g(G),g(k))};static \u0275cmp=j({type:n,selectors:[["app-chat"]],decls:2,vars:2,consts:[["class","chatIconContainer",3,"click",4,"ngIf"],["class","card text-center contenedor-chat",4,"ngIf"],[1,"chatIconContainer",3,"click"],["alt","chat Icon",1,"chatIcon",3,"src"],[1,"card","text-center","contenedor-chat"],[1,"card-header"],[1,"closeIcon",3,"click"],[1,"card-body"],["id","mensajes",1,"contenedor-mensajes","h-100"],["class","msj p-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card-footer","text-muted","input-group",3,"ngSubmit"],["type","text","placeholder","Escriba un mensaje...",1,"form-control",3,"ngModelChange","ngModel"],[1,"input-group-append"],["id","basic-addon2",1,"input-group-text"],[1,"msj","p-2",3,"ngClass"],[1,"mensaje-fecha"]],template:function(e,r){e&1&&C(0,X,2,1,"div",0)(1,q,14,2,"div",1),e&2&&(m("ngIf",!r.mostrarChat&&r.username!=null),s(),m("ngIf",r.mostrarChat))},dependencies:[W,H,B,F,L,z,U,R,N,P,V,D],styles:[".contenedor-chat[_ngcontent-%COMP%]{width:300px;height:450px;right:.5rem;bottom:.5rem;position:fixed}.card-header[_ngcontent-%COMP%]{background-color:#6666f3;color:#fff;font-weight:700}.card-body[_ngcontent-%COMP%]{padding:.5rem;background-color:#fff}.enviado[_ngcontent-%COMP%]{display:block;float:right;background-color:teal;color:#fff;min-width:50.01%;border-radius:10px;text-align:left}.recibido[_ngcontent-%COMP%]{display:block;float:left;background-color:gray;color:#fff;min-width:50.01%;border-radius:10px;text-align:left}.contenedor-mensajes[_ngcontent-%COMP%]{max-height:300px;overflow:scroll;overflow-y:auto;padding:.3rem;font-size:14px}.contenedor-mensajes[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.chatIconContainer[_ngcontent-%COMP%]{right:.5rem;bottom:.5rem;position:fixed;display:flex;justify-content:center;align-items:center;width:60px;height:60px;cursor:pointer;background-color:#a7a7a7;border-radius:100%;box-shadow:0 0 10px 2px #474747}.chatIcon[_ngcontent-%COMP%]{width:40px;height:40px}.closeIcon[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:0rem;cursor:pointer}.text-muted[_ngcontent-%COMP%]{font-size:12px;color:#fff}.mensaje-fecha[_ngcontent-%COMP%]{color:#00f;font-size:12px;font-style:italic}"]})};export{K as a};
